<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Aimday Schedule</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" media="screen" href="public/stylesheets/bootstrap.css">
        <script src="public/javascripts/jquery-1.7.1.js" type="text/javascript"></script>
        <script src="public/javascripts/bootstrap.js" type="text/javascript"></script>
        <script type='text/javascript' src="public/javascripts/knockout-2.1.0.js"></script>
        <script type='text/javascript' src="public/javascripts/knockout-sortable.js"></script>

        <script type="text/javascript" src="public/javascripts/jquery-ui-1.8.18.min.js"></script>
        <link rel="stylesheet" type="text/css" href="public/stylesheets/jquery-ui-1.8.14.css">
    </head>
    <body>

<div id="filler1" style="margin-bottom: 70px;">
<section id="help">
    <span class="pull-right">
      <a href="#helpModal" data-toggle="modal">Show help</a>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
    </span>
</section>

<div data-bind="if: model.hasSchema()">
<section id="schema">
  <div class="page-header">
    <h1>
    Schedule for <span data-bind="text: namn"></span></h1>
    <br>
    <span data-bind="if: optimeringsInformation.anvandVikter">
      When evaluating this schedule specific researcher experience is considered. This experience is called
       <span data-bind="text: optimeringsInformation.viktNamn"></span>
  </span>
  </div>
   <table class="table table-striped table-condensed">
       <thead>
           <tr>
          <!-- ko foreach: model.tracks -->
                 <th>Room <span data-bind="text: $index()+1"></span>                 </th>
        <!-- /ko -->
           </tr>
       </thead>
       <tbody>
        <!-- ko foreach: model.schema().sessioner -->
      <tr data-bind="sortable: { data: workshops,  connectClass:model.getUniqueConnectClass }" class="workshopz">
          <td>
            <b>
              <span data-bind="if: model.getFraga(frageId).ärLåstTillRum">
              <a href="#" title="Question is locked to this room"><i class="icon-lock"></i></a>
              </span>
              Question
              <span data-bind="text: frageId"> </span>
            </b>
            <ul data-bind="sortable: {data:forskare, beforeMove: model.verifyMoves}" class="unstyled">
              <li>
                <div data-bind="template: { name: 'forskar-template', data: model.getForskare($data) }"></div>
              </li>
            </ul>
            <a data-toggle="modal" data-bind="attr: {href:'#'+frageId}" >See full workshop</a>
            <div data-bind="attr: {id:frageId}" class="modal hide">
              <div data-bind="template: { name: 'modal-fraga-template'}"></div>
            </div>
          </td>
      </tr>
      <!-- /ko -->

    </tbody>
   </table>

    <div id="dragWarningModal" class="modal hide">
      <div class="modal-header">
        Disallowed move <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body" data-bind="text: lastError">
      </div>
      <div class="modal-footer">
        <a href="#" class="btn btn-primary" data-dismiss="modal">OK</a>
      </div>
    </div>


  <div data-bind="if: schema() != null">
    <div data-bind="if: schema().unplacedQuestions() != null && schema().unplacedQuestions().length >0">

      <br>In this schedule we failed to place:
      <ul data-bind="foreach: schema().unplacedQuestions">
          <li>
              Question <span data-bind="text: $data"></span>
          </li>
      </ul>
      An asterisk (*) after a question indicates that the question does not have any researchers on its list.
      <p>
    </div>
    <p>
    <div data-bind="if: schema().unsatisfied() != null && schema().unsatisfied().length >0">
      In this schedule the following
      (<span data-bind="text: schema().unsatisfied().length"></span>)
      participants were not placed in all their questions
      <ul data-bind="foreach: schema().unsatisfied">
          <li>
              <span data-bind="text: $data"></span>
          </li>
      </ul>
    </div>
  </div>
  <p>
  To use this schedule as a starting point for the next schedule generation you may lock the entire schedule in place:
  <br>
  <form class="form-horizontal" action="" method="POST" data-bind="submit: model.låsAllt">
    <button type="submit" class="btn btn-primary" >Lock all questions and researchers to this schedule</button>
  </form>


</section>
</div>
<section id="fragor">
  <div class="page-header">
    <h1>Questions</h1>
  </div>

  <table>
      <thead>
      </thead>
      <tbody data-bind="foreach: model.fragor">
          <tr>
              <td data-bind="text: id"></td>
              <td data-bind="text: cappadFråga"></td>
              <td>
                <a href="#" data-bind="click: edit">Locked to session <span data-bind="text: låst"></span></a>
                <a href="#" data-bind="visible: ärLåst, click: removeLås"> (remove all session locks)</a>
              </td>
              <td><select data-bind="visible: editing, hasfocus: editing, options: model.sessioner, selectedOptions: låst" multiple="true"></select></td>
              <td data-bind="visible: ärLåstTillRum">
                <a href="#"> Locked to room  <span data-bind="text: låstaRum"> </span></a>
                <a href="#" data-bind="click: removeLåstRum"> (unlock from room)</a>
              </td>
          </tr>
      </tbody>
  </table>

</section>
<section id="forskare">
  <div class="page-header">
    <h1>Researchers</h1>
  </div>

  <table>
      <thead>
      </thead>
      <tbody data-bind="foreach: model.forskare">
          <tr>
              <td>
          <div data-bind="template: { name: 'forskar-template' }"></div>
              </td>
              <td>
                <a href="#" data-bind="click: edit">Locked to session <span data-bind="text: låstaSessioner"></span></a>
                <a href="#" data-bind="visible: ärLåst, click: removeLås"> (remove all session locks)</a>
              </td>
              <td><select data-bind="visible: editingSession, hasfocus: editingSession, options: model.sessioner, selectedOptions: låstaSessioner" multiple="true"></select></td>

              <td>
                <a href="#" data-bind="click: editFraga">Locked to question <span data-bind="text: låstaFrågor"></span></a>
                <a href="#" data-bind="visible: ärLåstTillFråga, click: removeFrågeLås"> (remove all question locks)</a>
              </td>
              <td><select data-bind="visible: editingFraga, hasfocus: editingFraga, options: frageIdn, selectedOptions: låstaFrågor" multiple="true"></select></td>

          </tr>
      </tbody>
  </table>
</section>

<section id="generera">
  <div class="page-header">
    <h1></h1>
  </div>

  <form class="form-horizontal" data-bind="submit: model.generera">
  <fieldset>
       <div class="control-group">
       <label class="control-label" for="tracks">Number of rooms</label>
            <div class="controls">
       <input type="text" name="tracks" id="tracks"  data-bind="value:scheduleRequest.tracks"/>
       <span class="help-inline">At most this many rooms will be used at the same time in the generated schedule.
        The scheduler will try to use as few rooms as possible.
       </span>
       </div>
       </div>

       <div class="control-group">
       <label class="control-label" for="sessions">Number of sessions</label>
            <div class="controls">
       <input type="text" name="sessions" id="sessions" data-bind="value:scheduleRequest.sessions"/>
       </div>

       </div>


       <div class="control-group">
       <label class="control-label" for="generations">Number of generations</label>
            <div class="controls">
       <input type="text" name="generations" id="generations" data-bind="value:scheduleRequest.generations"/>
       <span class="help-inline">How long should the scheduler look for a schedule? </span>
       </div>
       </div>

          <p class="help-block">
          Move sliders: more important to the right, less important to the left. This will change how the optimizer
          chooses which schedule is the best.
          </p>

       <div class="control-group">
      <label class="control-label" for="placeWeight">How important is it that every question is in the schedule?</label>
            <div class="controls">
               <div data-bind="jqSlider: scheduleRequest.placeWeight, jqOptions: { min: 0, max: 100, animate: true}" style="width: 400px; margin-top:10px;"></div>
        </div>
       </div>

       <div class="control-group">
        <label class="control-label">How important is it that each question has experienced participants?</label>
            <div class="controls">
               <div data-bind="jqSlider: scheduleRequest.wsWeight, jqOptions: { min: 0, max: 100, animate: true }" style="width: 400px; margin-top:10px;"></div>
      </div>
       </div>

       <div class="control-group">
        <label class="control-label">How important is it that the researchers' wishes have been fulfilled?</label>
            <div class="controls">
               <div data-bind="jqSlider: scheduleRequest.agendaWeight, jqOptions: { min: 0, max: 100, animate: true }" style="width: 400px; margin-top:10px;"></div>
      </div>
       </div>

       <div class="control-group">
       <label class="control-label">Maximum number  </label>
            <div class="controls">
         <select name="max_antal_deltagare" data-bind="value:scheduleRequest.maxAntalDeltagare">
        <option value="100">no limit</option>
        <option value="6">6 participants</option>
        <option value="7">7 participants</option>
        <option value="8">8 participants</option>
        <option value="9">9 participants</option>
        <option value="10">10 participants</option>
        <option value="11">11 participants</option>
        <option value="12">12 participants</option>
      </select>
       <span class="help-inline">
        How many participants (researchers + company reps) should each workshop at most have?
       </span>
       </div>
       </div>

       <div class="control-group">
       <label class="control-label">Minimum number</label>
            <div class="controls">
         <select name="min_antal_deltagare" data-bind="value:scheduleRequest.minAntalDeltagare">
        <option value=1>1 researcher</option>
        <option value=2>2 researchers</option>
        <option value=3>3 researchers</option>
        <option value=4>4 researchers</option>
      </select>
       <span class="help-inline">For a question to be scheduled it needs at least this many researchers
       </span>
       </div>
       </div>

       <input type="hidden" data-bind="value: model.genereradJson" name="json"></input>
       <br>
    <button type="submit" class="btn btn-primary" >Generate new schedule</button>
    </fieldset>

   </form>



</section>
<div id="bugreport">
  <span class="pull-right">
    <a href="#bugReportModal" data-toggle="modal">Report error</a> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
  </span>
  <div>&nbsp</div>
</div>
</div>
<div class="navbar navbar-fixed-bottom" data-bind="visible: !sparat()">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="#">This schedule has unsaved changes. </a>
    <form class="form-horizontal" action="${postback_url}" method="POST" data-bind="submit: model.saveSchedule">
      <input type="hidden" data-bind="value: model.genereradJson" name="json"></input>
      <button type="submit" class="btn btn-primary" >Save schedule</button>
    </form>
    </div>
  </div>
</div>

<!--############ TEMPLATES #################-->

<script type="text/html" id="forskar-template">
  <span data-bind="if: harVikt">
  <a href="#" title="This researcher is marked as having specific experience for this aimday."><i class="icon-flag"></i></a>
  </span>
  <span data-bind="if: joker">
  <a href="#" title="This researcher is a joker/wild card and will be placed last of all in questions that need more
  experience
  "><i class="icon-star"></i></a></span>
  <span data-bind="text: namn"></span>, <span data-bind="text: model.getGrad(grad)"> </span>&nbsp<span data-bind="text: kontakt().avdelning"></span>
</script>

<script type="text/html" id="rep-template">
  <span data-bind="text: namn"></span>,  <span data-bind="text: kontakt().org"></span>
</script>

<script type="text/html" id="modal-fraga-template">
    <div class="modal-header">
      Question <span data-bind="text: frageId"></span>:
      <span data-bind="text: model.getFraga(frageId).fråga"></span>
      <button type="button" class="close" data-dismiss="modal">&times;</button>
    </div>
    <div class="modal-body">
    <ul data-bind="foreach: forskare" class="unstyled">
      <li>
        <div data-bind="template: { name: 'forskar-template', data: model.getForskare($data) }"></div>
      </li>
    </ul>
    <ul data-bind="foreach: foretagsrepresentanter" class="unstyled">
      <li>
        <div data-bind="template: { name: 'rep-template', data: model.getRep($data) }"></div>
      </li>
    </ul>
    </div>
    <div class="modal-footer">
      <a href="#" class="btn btn-primary" data-dismiss="modal">OK</a>
    </div>
</script>

<!--############ /TEMPLATES #################-->


<!--############ DIALOGS #################-->

<div id="generationProgressReport" class="modal hide fade" tabindex="-1" role="dialog">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Your schedule is being generated...</h3>
  </div>
  <div class="modal-body">
    Your schedule is <span data-bind="text:progress"></span>% complete.
  </div>
  <div class="modal-footer">
    <button class="btn" data-bind="enable: !isGenerating(), click: changeToNewSchedule">View new schedule</button>
    <button class="btn" data-bind="enable: isGenerating, click: cancelGeneration" data-dismiss="modal" aria-hidden="true">Cancel generation</button>
  </div>
</div>

<div id="helpModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Create a schedule for your Aimday</h3>
  </div>
  <div class="modal-body">
    Creating an aimday schedule is about meeting conflicting needs: <br>
    Is it more important to fit many questions in your aimday, to fill the schedule with many workshops? Or would you
    rather ensure that the workshops are well attended by experienced researchers? Or maybe it is most important that
    the researchers wishes are fulfilled so that they always be placed in their top priority questions...
    <p>
    <p>
    There is no one <b>right</b> schedule so depending on what you think is important this tool helps you generate a schedule
    that fits <b>your</b> choices. This schedule is your starting point - from it you are free to rearrange
    questions (try drag-and-drop!) and participants and even add more questions or researchers if needed.
  <p>
  See the <a href="http://aimday.se/wp-content/plugins/aimday_oop/images/UserGuide_eng.pdf" target="_blank">aimday handbook</a> for more details.
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<div id="bugReportModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Weird schedule? Found a bug?</h3>
  </div>
  <div class="modal-body">
    Please help us make the scheduler better by giving us a report. Send an e-mail to anette.persson.stache@uuinnovation.uu.se stating what your
    settings were (number of rooms etc), what you think is wrong with the schedule and please include this json to make
    it easier for us to find out what went wrong.

    Copy from here:
    <div data-bind="text:bugreport" style="white-space: nowrap;">
    </div>
    ..to here!

  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<!--############ /DIALOGS #################-->


<script type="text/javascript">

  var useWebWorker = true;
  // schedule for a brand new conference:
//  var json = {"postback_url":"http://aimdaylabb.se.preview.binero.se/materials/parse-json/","id":"1","namn":"Aimday life science","optimeringsInformation":{"anvandVikter":true,"viktNamn":"Har klinisk erfarenhet"},"senioritetsgrader":["Överl.","Prof.","Doc.","Dr.","Doktorand"],"fragor":[{"id":"f1","fråga":"What is the cure for the common cold?","vikt":5,"låst":[]},{"id":"f2","fråga":"What is the cure for the common cancer?","vikt":0,"låst":[]},{"id":"f3","fråga":"What is the cure for the common arne?","vikt":0,"låst":[]},{"id":"f4","fråga":"What is the cure for the common bjarne?","vikt":0,"låst":[]}],"foretagsrepresentanter":[{"id":"rep1","kontakt":{"fornamn":"Arne","efternamn":"Företagskontakt","org":"Ett företag"},"frågor":["f1","f2"]}],"forskare":[{"harVikt":true,"id":"id1","grad":2,"frågor":["f1","f2"],"joker":true,"kontakt":{"fornamn":"Arne","efternamn":"Arnesson","avdelning":"Institutionen för materialfysik","org":"Uppsala universitet"},"låstaFrågor":[],"låstaSessioner":[]},{"harVikt":false,"id":"id2","grad":1,"frågor":["f2","f3"],"joker":false,"kontakt":{"fornamn":"Bjarne","efternamn":"Bengtsson","avdelning":"Institutionen för neurologi","org":"Uppsala universitet"},"låstaFrågor":[],"låstaSessioner":[]},{"harVikt":false,"id":"id3","grad":3,"frågor":["f4"],"joker":false,"kontakt":{"fornamn":"Carl","efternamn":"Carlsson","avdelning":"Institutionen för materialfysik","org":"Lunds universitet"},"låstaFrågor":[],"låstaSessioner":[]}],"schema":{},"låsningar":{"frågesessionslås":[{"id":"f1","låsttill":[1]}],"forskarfrågelås":[{"id":"id3","låsttill":["f4"]}],"forskarsessionslås":[{"id":"id1","låsttill":[1]}]}};

//  var json = {"id":"1","postback_url":"http://aimdaylabb.se.preview.binero.se/materials/parse-json/","namn":"Aimday life science","optimeringsInformation":{"anvandVikter":true,"viktNamn":"Har klinisk erfarenhet"},"senioritetsgrader":["Överl.","Prof.","Doc.","Dr.","Doktorand"],"fragor":[{"id":"f1","fråga":"What is the cure for the common cold?","vikt":5,"låst":[1],"låstaRum":[]},{"id":"f2","fråga":"What is the cure for the common cancer?","vikt":0,"låst":[],"låstaRum":[]},{"id":"f3","fråga":"What is the cure for the common arne?","vikt":0,"låst":[],"låstaRum":[]},{"id":"f4","fråga":"What is the cure for the common bjarne?","vikt":0,"låst":[],"låstaRum":[]}],"foretagsrepresentanter":[{"id":"rep1","kontakt":{"fornamn":"Arne","efternamn":"Företagskontakt","org":"Ett företag"},"frågor":["f1","f2"]}],"forskare":[{"harVikt":true,"id":"id1","grad":2,"frågor":["f1","f2"],"joker":true,"kontakt":{"fornamn":"Arne","efternamn":"Arnesson","avdelning":"Institutionen för materialfysik","org":"Uppsala universitet"},"låstaFrågor":[],"låstaSessioner":[1]},{"harVikt":false,"id":"id2","grad":1,"frågor":["f2","f3"],"joker":false,"kontakt":{"fornamn":"Bjarne","efternamn":"Bengtsson","avdelning":"Institutionen för neurologi","org":"Uppsala universitet"},"låstaFrågor":[],"låstaSessioner":[]},{"harVikt":false,"id":"id3","grad":3,"frågor":["f4"],"joker":false,"kontakt":{"fornamn":"Carl","efternamn":"Carlsson","avdelning":"Institutionen för materialfysik","org":"Lunds universitet"},"låstaFrågor":["f4"],"låstaSessioner":[]}],"schema":{"sessioner":[{"workshops":[{"frageId":"f1","forskare":["id1"],"foretagsrepresentanter":["rep1"],"score":0.0},{"frageId":"f2","forskare":["id2"],"score":0.0}]},{"workshops":[{"frageId":"f3","forskare":["id2"],"score":0.0},{"frageId":"f4","forskare":["id3"],"score":0.0}]}],"sparat":true},"låsningar":{"frågesessionslås":[{"id":"f1","låsttill":[1]}],"forskarsessionslås":[{"id":"id1","låsttill":[1]}],"forskarfrågelås":[{"id":"id3","låsttill":["f4"]}]}};
//  var json = {"id":"20","postback_url":"http://aimday.se/publicmanagement/wp-admin/admin.php?page=aimday-optimization&process=true","namn":"Conference #21","optimeringsInformation":{"anvandVikter":false,"viktNamn":"Har klinisk erfarenhet(hårdkodat"},"senioritetsgrader":["Doktor","Prof.","Doc.","Doktorand","Annat"],"fragor":[{"id":"280","fråga":"Skollagen ger rektorer stor beslutanderätt i skolfrågor. Politiker vill ibland prioritera annorlunda. Hur skall de bäst förenas?","vikt":0,"låst":[1],"låstaRum":[3]},{"id":"285","fråga":"Varför skjuta på pianot (NPM)?","vikt":0,"låst":[1],"låstaRum":[2]},{"id":"286","fråga":"Hur kan kvalitet värderas och följas upp, hur mäter vi ett gott resultat?\r\nVika metoder och kriterier existerar för att värdera och följa upp kvalitet? Fördelar, brister, jämförande approach. ","vikt":0,"låst":[1],"låstaRum":[6]},{"id":"288","fråga":"Ur ett systemperspektiv, går det att kombinera effektivitet med kvalitet? ","vikt":0,"låst":[3],"låstaRum":[4]},{"id":"289","fråga":"Hur kan man arbeta för jämn och hög kvalitet i vården och offentlig sektor i allmänhet på ett meningsfullt sätt?","vikt":0,"låst":[1],"låstaRum":[10]},{"id":"304","fråga":"Ansvarsutkrävande är en viktig beståndsdel i en demokratiskt styrd organisation. I NPM-modeller finns en uppenbar risk att beställare och utförare skyller på varandra, och skickar ansvaret fram och tillbaka. D.v.s. ingen tar ansvar. Vem ska då den enskilda medborgaren/brukaren ställa till svars och utkräva ansvar av?","vikt":0,"låst":[2],"låstaRum":[1]},{"id":"305","fråga":"Hur skapas en struktur och förutsättningar för att utveckla verksamheten? ","vikt":0,"låst":[],"låstaRum":[]},{"id":"306","fråga":"Var och hur drar man gränsen mellan politikerbeslut respektive tjänstemannabeslut? ","vikt":0,"låst":[2],"låstaRum":[2]},{"id":"307","fråga":"Vad får mätning för styrning av offentlig verksamhet kosta?","vikt":0,"låst":[2],"låstaRum":[3]},{"id":"308","fråga":"Kan man se samband mellan kundnöjdhet, hos t.ex. en bygglovssökande, och i vilken grad beslut varit till fördel för kunden.","vikt":0,"låst":[1],"låstaRum":[4]},{"id":"309","fråga":"Kan vi utsätta ideella eller semi-ideella krafter med den granskning och den administration som mätning av kvalitet och resultat innebär utan att de tappar sitt ideella engagemang? ","vikt":0,"låst":[],"låstaRum":[]},{"id":"311","fråga":"Hur bör tillsyn på bästa sätt utformas för att leda till ökad kvalitet i den inspekterade verksamheten?","vikt":0,"låst":[3],"låstaRum":[5]},{"id":"312","fråga":"Hur kan uppföljningar och utvärderingar användas för att styra enskilda välfärdsproducenter?","vikt":0,"låst":[2],"låstaRum":[6]},{"id":"317","fråga":"Hur kan vi styra våra processer så att den som möter oss får samma upplevelse av vårt bemötande oavsett utfallet i sakfrågan? ","vikt":0,"låst":[],"låstaRum":[]},{"id":"318","fråga":"Vad är egentligen ett ledningssystem?","vikt":0,"låst":[],"låstaRum":[]},{"id":"319","fråga":"Hur skapa balans mellan linjeansvar och funktionsansvar? ","vikt":0,"låst":[2],"låstaRum":[7]},{"id":"323","fråga":"Vad kan kommunen göra på kort och lång sikt för att motverka skolsegregationen/segregationen inom förskolan? D.v.s. vilka krafter skapar segregationen? Vilka är motkrafterna till segregationen? Hur är krafterna påverkbara? ","vikt":0,"låst":[3],"låstaRum":[2]},{"id":"327","fråga":"”Hur ska politiker styra en marknad? – på jakt efter beställar-utförarmodellen 2.0”","vikt":0,"låst":[2],"låstaRum":[4]},{"id":"335","fråga":"Hur ska vi som tillsynsmyndighet få en organisation att reagera på just vår styrsignal? ","vikt":0,"låst":[],"låstaRum":[]},{"id":"336","fråga":"Fördelar och nackdelar med alternativ till New Public Management för sjukvården. ","vikt":0,"låst":[2],"låstaRum":[13]},{"id":"348","fråga":"Hur vinner en offentlig organisation bäst förtroende, skapar partnerskap eller betraktas som en medspelare med näringslivet? ","vikt":0,"låst":[3],"låstaRum":[7]},{"id":"350","fråga":"Upphandlingsområdet \r\na.\tGrön upphandling – hur stimulerar/styr man kommuner i användandet av grön upphandling?\r\n\r\n","vikt":0,"låst":[],"låstaRum":[]},{"id":"351","fråga":"Vård och omsorg styrs allt mer av riktlinjer och direktiv som redovisas och följs upp i mätbara kvantitativa mått. Det som inte mäts eller kan mätas finns inte. Vilket utrymme ges då åt personalens professionella bedömningar i mötet? ","vikt":0,"låst":[3],"låstaRum":[6]},{"id":"352","fråga":"Hur mäter vi inom offentlig sektor utfallet av satsningar på FoU och innovation?","vikt":0,"låst":[3],"låstaRum":[10]},{"id":"353","fråga":"Vad lär vi oss egentligen av utvärderingar? ","vikt":0,"låst":[1],"låstaRum":[9]},{"id":"354","fråga":"4a Kan man tackla samhällsutmaningar i organisatoriska stuprör? Vem tar ansvar för helheten?\r\n\r\n","vikt":0,"låst":[],"låstaRum":[]},{"id":"355","fråga":"Staten har uppenbarligen olika behov av att styra. Som praktiker med ett regionalt helhetsperspektiv ser vi t ex att vi får mycket friare händer från näringsdepartementet än från socialdepartementet. Vad är detta ett uttryck för? Hur uppstår olika ”styrningsfilosofier”?","vikt":0,"låst":[3],"låstaRum":[1]},{"id":"356","fråga":" Hur ser ledarskapet i offentlig sektor i en NPM kontext ut? ","vikt":0,"låst":[1],"låstaRum":[7]},{"id":"361","fråga":"Har offentlig verksamhet förutsättningar att överleva i konkurrens med de privata?","vikt":0,"låst":[2],"låstaRum":[8]},{"id":"362","fråga":"Var går gränserna för det offentliga uppdraget?","vikt":0,"låst":[3],"låstaRum":[9]},{"id":"363","fråga":"Vad har offentlig förvaltning att lära av det privata näringslivet som beställare?","vikt":0,"låst":[],"låstaRum":[]},{"id":"364","fråga":"Mäta i all ära, men hur görs analysen av mått och resultat, så att en faktisk förbättring av produktionsprocesser kan ske i organisationen?","vikt":0,"låst":[2],"låstaRum":[5]},{"id":"366","fråga":"Hur kan lärande mellan kommuner och landsting underlättas och fås att öka? Vilka system, förhållningssätt och mekanismer kan användas för att fånga upp de goda förebildernas arbetssätt, så att organisationen kan använda liknande angreppssätt för verksamhetsutveckling?","vikt":0,"låst":[],"låstaRum":[]},{"id":"367","fråga":"Hur undviker man att uppföljning blir ett byråkratiskt monster och i stället kan användas för verksamhetsutveckling? Hur får man in verksamhetsutveckling som en naturlig del av uppföljningen? ","vikt":0,"låst":[1],"låstaRum":[1]},{"id":"368","fråga":"Hur kan uppföljningen bidra till att skapa medvetenhet om, och jämna ut skillnader i, den service som ges till individer och grupper av individer?","vikt":0,"låst":[2],"låstaRum":[9]},{"id":"369","fråga":"Hur kan kommuner och landsting lösa utmaningen avseende effektivitet och styrning i framtiden? Hur kan vi med ökade behov men inte mer resurser lösa framtidens utmaningar? Är dagens verksamhet effektiv nog? Behöver styrningen förändras?","vikt":0,"låst":[3],"låstaRum":[3]},{"id":"370","fråga":"Finns det forskning som kan verifiera eller motsäga att konkurrens och valfrihet ger bättre och effektivare tjänster i offentlig sektor?","vikt":0,"låst":[3],"låstaRum":[8]},{"id":"427","fråga":"Konkurrens mellan kommunala och privata alternativ: Kan en kommunal produktion någonsin tävla med privata alternativ så länge som de bara får sälja till en köpare? Hur kan en kommunal produktion konkurrera med sina privata konkurrenter på bästa sätt utifrån sina förutsättningar?\r\n\r\nHur kan skolor tänkas ingå i den så kallade ”kommunala produktionen” och konkurrera med fristående skolor på lika villkor när de styrs olika och den ena gruppen måste ta emot alla elever medan den andra kan begränsa urvalet (olika behandling i lagen)?\r\n","vikt":0,"låst":[2],"låstaRum":[12]},{"id":"431","fråga":"Valfrihet:\r\nMed utgångspunkt i att valfriheten ska utvecklas handlar våra frågor om vilka faktorer som faktiskt påverkar valen. Idag erbjuder den offentliga verksamheten betydligt fler valmöjligheter än tidigare men i vilken utsträckning får en ökad mängd valmöjligheter individerna att göra aktiva val? \r\n\r\nVilka andra faktorer och mekanismer (än en mängd olika sorters verksamheter) påverkar benägenheten att välja och vilka grupper påverkas av vilka faktorer? \r\n\r\nHur påverkar det egna valet upplevelsen av kvalitet?\r\n\r\nHur skulle ett välfärdskontor som UAK kunna arbeta för att öka individernas benägenhet att göra aktiva och medvetna val?\r\n","vikt":0,"låst":[],"låstaRum":[]},{"id":"434","fråga":"Hur kan offentlig verksamhet genom LOU använda upphandlingar för att främja kompetensutveckling hos företag både på kort sikt och i ett långsiktigt perspektiv?","vikt":0,"låst":[2],"låstaRum":[11]},{"id":"435","fråga":"Om det är så att utvärdering inifrån skapar utveckling kan då utvärdering utifrån leda till ökad likvärdighet?\r\n\r\nHur kan kommunen säkra likvärdig kvalitet hos förskolor och grundskolor? Generellt för alla enheter och specifikt för enheter med ett större kompensatoriskt uppdrag.","vikt":0,"låst":[],"låstaRum":[]},{"id":"441","fråga":"Tankar till balansgången mellan att föra ut kostnaden på varje enhet och öka ekonomistyrningen utan att flödet på övergripande nivå påverkas negativt.","vikt":0,"låst":[1],"låstaRum":[5]},{"id":"444","fråga":"Hur kan man leda processutvecklingsarbete i organisationen som främjar delaktighet?\r\n","vikt":0,"låst":[2],"låstaRum":[10]},{"id":"501","fråga":"Hur kan man utveckla konceptet ”Idéburet Offentligt Partnerskap”? Var finns dess svagheter och styrkor? \r\n\r\nBehövs det särskilda regler för en särskild sektor? Kanske passar inte LOU i dess nuvarande utformning den idéburna sektorn. Upphandlingsutredningen kom ju inte ända i mål – och Anders Wijkman sa att det finns frågor kvar att titta på inte minst när det gäller vår sektor. Så för att ställa frågan på sin spetts behövs det särskilda regler för oss? ","vikt":0,"låst":[1],"låstaRum":[8]},{"id":"502","fråga":"Hur kan man mäta värdet av ett bra samspel med civilsamhället och effekten av brukarmedverkan? Hur kan det integreras i uppföljningssystemen? \r\n\r\nCivilsamhället kan inte styras genom direktiv eller fullmäktigebeslut - för ett fruktbart samspel krävs dialog och jämbördiga parter. Behöver de kommunala styrningsverktygen ändras för att det ska bli möjligt bygga ett samspel med civilsamhällesorganisationer?","vikt":0,"låst":[],"låstaRum":[]}],"foretagsrepresentanter":[{"id":"276","kontakt":{"fornamn":"Nils","efternamn":"Eklund","org":"Ekonomistyrningsverket"},"frågor":["285"]},{"id":"281","kontakt":{"fornamn":"Ingrid","efternamn":"Rydell","org":"Ramböll Management"},"frågor":["289"]},{"id":"282","kontakt":{"fornamn":"Åsa","efternamn":"Karlsson","org":"Ramböll Management"},"frågor":["289"]},{"id":"283","kontakt":{"fornamn":"Jan-Åke","efternamn":"Olsson","org":"Älvkarleby kommun"},"frågor":[]},{"id":"290","kontakt":{"fornamn":"Christina ","efternamn":"Fahlman","org":"Lasarettet i Enköping"},"frågor":["441","444"]},{"id":"291","kontakt":{"fornamn":"Linn","efternamn":"Sunnelid","org":"Lasarettet i Enköping"},"frågor":["441","444"]},{"id":"307","kontakt":{"fornamn":"Andreas","efternamn":"Endredi","org":"Uppsala läns landsting"},"frågor":["319","318"]},{"id":"314","kontakt":{"fornamn":"Liv ","efternamn":"Fries","org":"Stockholms läns landsting, Landstingsstyrelsens förvaltning"},"frågor":["327"]},{"id":"315","kontakt":{"fornamn":"Christina ","efternamn":"Söderholm","org":"Stockholms läns landsting, Landstingsstyrelsens förvaltning"},"frågor":["327"]},{"id":"326","kontakt":{"fornamn":"Ewa","efternamn":"Sunneborn","org":"Inspektionen för vård och omsorg"},"frågor":["335"]},{"id":"327","kontakt":{"fornamn":"Birgitta","efternamn":"Hagström","org":"Inspektionen för vård och omsorg"},"frågor":["335"]},{"id":"328","kontakt":{"fornamn":"Anna","efternamn":"Wahlström","org":"KPMG"},"frågor":["336"]},{"id":"340","kontakt":{"fornamn":"Gunilla","efternamn":"Söderström","org":"G2K Education AB"},"frågor":["356"]},{"id":"324","kontakt":{"fornamn":"Karin","efternamn":"Carlsson","org":"Uppsala kommun"},"frågor":[]},{"id":"325","kontakt":{"fornamn":"Sofia","efternamn":"Aronsson","org":"Uppsala kommun"},"frågor":[]},{"id":"321","kontakt":{"fornamn":"Astrid","efternamn":"Nyström","org":"Uppsala kommun"},"frågor":["431"]},{"id":"322","kontakt":{"fornamn":"Örjan","efternamn":"Trapp","org":"Uppsala kommun"},"frågor":[]},{"id":"323","kontakt":{"fornamn":"Ulf","efternamn":"lundström","org":"Uppsala kommun"},"frågor":[]},{"id":"320","kontakt":{"fornamn":"Maria","efternamn":"Hedefalk","org":"Uppsala kommun"},"frågor":[]},{"id":"319","kontakt":{"fornamn":"Sophie","efternamn":"Rouaud","org":"Uppsala kommun"},"frågor":["431","427"]},{"id":"318","kontakt":{"fornamn":"Annbritt","efternamn":"Öqvist","org":"Uppsala kommun"},"frågor":["431","435"]},{"id":"316","kontakt":{"fornamn":"Jennie","efternamn":"Lindbergh","org":"Uppsala kommun"},"frågor":["431"]},{"id":"317","kontakt":{"fornamn":"Ann","efternamn":"Larsén","org":"Uppsala kommun"},"frågor":["431"]},{"id":"313","kontakt":{"fornamn":"Boel","efternamn":"Vallgårda","org":"Uppsala kommun"},"frågor":["435","323"]},{"id":"310","kontakt":{"fornamn":"Märit","efternamn":"Gunneriusson Karlström","org":"Uppsala kommun"},"frågor":["431","312"]},{"id":"305","kontakt":{"fornamn":"Karin ","efternamn":"Svensson","org":"Uppsala kommun"},"frågor":["317"]},{"id":"306","kontakt":{"fornamn":"Linda ","efternamn":"Granvik","org":"Uppsala kommun"},"frågor":["317"]},{"id":"301","kontakt":{"fornamn":"Henrik","efternamn":"Säfström Danielsson","org":"Uppsala kommun"},"frågor":["311","312"]},{"id":"299","kontakt":{"fornamn":"Johan","efternamn":"Lindqvist","org":"Uppsala kommun"},"frågor":["309"]},{"id":"296","kontakt":{"fornamn":"Barbro","efternamn":"Rinander","org":"Uppsala kommun"},"frågor":["307"]},{"id":"297","kontakt":{"fornamn":"Michael","efternamn":"Ekström","org":"Uppsala kommun"},"frågor":["306"]},{"id":"298","kontakt":{"fornamn":"Maria ","efternamn":"Arvola","org":"Uppsala kommun"},"frågor":["308"]},{"id":"295","kontakt":{"fornamn":"Ulrik ","efternamn":"Wärnsberg","org":"Uppsala kommun"},"frågor":["304","305"]},{"id":"280","kontakt":{"fornamn":"Håkan","efternamn":"Eriksson","org":"Uppsala kommun"},"frågor":["288"]},{"id":"278","kontakt":{"fornamn":"Maria","efternamn":"Ahrgren","org":"Uppsala kommun"},"frågor":["286"]},{"id":"277","kontakt":{"fornamn":"Mohamad","efternamn":"Hassan","org":"Uppsala kommun"},"frågor":[]},{"id":"275","kontakt":{"fornamn":"Marianne","efternamn":"Sellgren","org":"Uppsala kommun"},"frågor":[]},{"id":"396","kontakt":{"fornamn":"Hilde ","efternamn":"Klasson","org":"Uppsala kommun"},"frågor":["304","305"]},{"id":"272","kontakt":{"fornamn":"Cecilia","efternamn":"Forss","org":"Regionförbundet Uppsala län"},"frågor":["280"]},{"id":"336","kontakt":{"fornamn":"Catharina","efternamn":"Blom","org":"Regionförbundet Uppsala län"},"frågor":["353","355"]},{"id":"337","kontakt":{"fornamn":"Bo ","efternamn":"Lerman","org":"Regionförbundet Uppsala län"},"frågor":["351","434"]},{"id":"338","kontakt":{"fornamn":"Gudrun","efternamn":"Tevell","org":"Regionförbundet Uppsala län"},"frågor":["353","354","434"]},{"id":"339","kontakt":{"fornamn":"Tomas","efternamn":"Stavbom","org":"Regionförbundet Uppsala län"},"frågor":["352","354"]},{"id":"404","kontakt":{"fornamn":"Maria","efternamn":"Didi","org":"Regionförbundet Uppsala län"},"frågor":["352","350"]},{"id":"405","kontakt":{"fornamn":"Anna-Lena","efternamn":"Jansson","org":"Regionförbundet Uppsala län"},"frågor":["348"]},{"id":"407","kontakt":{"fornamn":"Katarina","efternamn":"Lif Pikas","org":"Regionförbundet Uppsala län"},"frågor":[]},{"id":"408","kontakt":{"fornamn":"Caroline","efternamn":"Quistberg","org":"Regionförbundet Uppsala län"},"frågor":[]},{"id":"409","kontakt":{"fornamn":"Andy","efternamn":"Metcalfe","org":"Regionförbundet Uppsala län"},"frågor":["352","354","350"]},{"id":"410","kontakt":{"fornamn":"Bengt","efternamn":"Finn","org":"Regionförbundet Uppsala län"},"frågor":["351","353","354"]},{"id":"411","kontakt":{"fornamn":"Brita","efternamn":"Gustafsson","org":"Regionförbundet Uppsala län"},"frågor":["351","354","434"]},{"id":"412","kontakt":{"fornamn":"Carin","efternamn":"Östling","org":"Regionförbundet Uppsala län"},"frågor":["354"]},{"id":"413","kontakt":{"fornamn":"Karin","efternamn":"Liljeberg","org":"Regionförbundet Uppsala län"},"frågor":["354"]},{"id":"343","kontakt":{"fornamn":"Gunnar","efternamn":"Gidenstam","org":"Sveriges Kommuner och Landsting "},"frågor":["370","364","366"]},{"id":"344","kontakt":{"fornamn":"Torkel","efternamn":"Wadman","org":"Sveriges Kommuner och Landsting "},"frågor":["370","364","367"]},{"id":"345","kontakt":{"fornamn":"Annika","efternamn":"Asplind","org":"Sveriges Kommuner och Landsting "},"frågor":["366","369","368"]},{"id":"346","kontakt":{"fornamn":"Åsa","efternamn":"Franzén","org":"Sveriges Kommuner och Landsting "},"frågor":["364","367","369"]},{"id":"341","kontakt":{"fornamn":"Marie","efternamn":"Pernebring","org":"Sveriges Kommuner och Landsting "},"frågor":["502"]},{"id":"342","kontakt":{"fornamn":"Lena","efternamn":"Svensson","org":"Sveriges Kommuner och Landsting "},"frågor":["361","362","363"]},{"id":"421","kontakt":{"fornamn":"Eva ","efternamn":"Hall","org":"Svenska Röda Korset"},"frågor":["501"]}],"forskare":[{"harVikt":false,"id":"680","grad":1,"frågor":["286","288","311","312"],"joker":false,"kontakt":{"fornamn":"Lewin","efternamn":"Barbro","avdelning":"Statsvetenskap (pensionär)","org":"Uppsala"},"låstaFrågor":["286","312","311"],"låstaSessioner":[]},{"harVikt":false,"id":"683","grad":1,"frågor":["285","319","336","351","356","355","304","307","288","327"],"joker":false,"kontakt":{"fornamn":"Olof","efternamn":"Wilske","avdelning":"Juridicum","org":"Riksdagens utredningstjänst/Uppsala univ"},"låstaFrågor":["356","319","351"],"låstaSessioner":[]},{"harVikt":false,"id":"733","grad":1,"frågor":["367","305","286","288","364","318","319","336","356","351"],"joker":false,"kontakt":{"fornamn":"Niklas","efternamn":"Källberg","avdelning":"Department of Management and Organization","org":"Handelshögskolan i Stockholm"},"låstaFrågor":["367"],"låstaSessioner":[1]},{"harVikt":false,"id":"754","grad":3,"frågor":["327","286","288","289","502","502","364","370","431","501"],"joker":true,"kontakt":{"fornamn":"Anders ","efternamn":"Forssell","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["289","364","370"],"låstaSessioner":[]},{"harVikt":false,"id":"765","grad":1,"frågor":["285","364","307","369","441"],"joker":false,"kontakt":{"fornamn":"Arne","efternamn":"Sjöblom","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["441","307","369"],"låstaSessioner":[]},{"harVikt":false,"id":"774","grad":2,"frågor":["285","336","327","367","363","353","434","370","361"],"joker":false,"kontakt":{"fornamn":"Nils-Göran","efternamn":" Olve","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["367","434","370"],"låstaSessioner":[]},{"harVikt":false,"id":"776","grad":3,"frågor":["351","317","308","364"],"joker":false,"kontakt":{"fornamn":"Anders","efternamn":"Flykt","avdelning":"Socialt arbete och psykologi","org":"Högskolan i Gävle"},"låstaFrågor":["364","351"],"låstaSessioner":[]},{"harVikt":false,"id":"788","grad":1,"frågor":["502","280","306","355","323"],"joker":false,"kontakt":{"fornamn":"Anders ","efternamn":"Westlin","avdelning":"Kansliet för humaniora och samhällsvetenskap","org":"Uppsala universitet"},"låstaFrågor":["280","306","323"],"låstaSessioner":[]},{"harVikt":false,"id":"792","grad":4,"frågor":["285","356","355","304","317","319","354"],"joker":false,"kontakt":{"fornamn":"Eva Maria","efternamn":"Magnusson","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["285","319","355"],"låstaSessioner":[]},{"harVikt":false,"id":"794","grad":4,"frågor":["352","350"],"joker":false,"kontakt":{"fornamn":"Kristofer","efternamn":"Severinsson","avdelning":"Industriell teknik","org":"Uppsala Universitet"},"låstaFrågor":["352"],"låstaSessioner":[]},{"harVikt":false,"id":"795","grad":4,"frågor":["352","350"],"joker":false,"kontakt":{"fornamn":"Petter","efternamn":"B. Forsberg","avdelning":"Industriell teknik","org":"Uppsala Universitet"},"låstaFrågor":["352"],"låstaSessioner":[]},{"harVikt":false,"id":"796","grad":3,"frågor":["288","285","307","304","353"],"joker":false,"kontakt":{"fornamn":"Linda","efternamn":"Wedlin","avdelning":"Företagsekonomiska institutionen ","org":"Uppsala Universitet"},"låstaFrågor":["285","304"],"låstaSessioner":[1,2]},{"harVikt":false,"id":"797","grad":3,"frågor":["311","435","356","280","323","368","427"],"joker":false,"kontakt":{"fornamn":"Elisabet","efternamn":"Nihlfors","avdelning":"Institutionen för pedagogik, didaktik och utbildningsstudier","org":"Uppsala universitet"},"låstaFrågor":["356","427","323"],"låstaSessioner":[]},{"harVikt":false,"id":"798","grad":4,"frågor":["370","431","427","312","289","361","353","336","327"],"joker":false,"kontakt":{"fornamn":"Gabriella ","efternamn":"Chrico","avdelning":"Nationalekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["289","427"],"låstaSessioner":[1,2]},{"harVikt":false,"id":"799","grad":1,"frågor":["285","312","369"],"joker":false,"kontakt":{"fornamn":"Cecilia","efternamn":"Lindholm","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet "},"låstaFrågor":["285","312","369"],"låstaSessioner":[]},{"harVikt":false,"id":"800","grad":1,"frågor":["308","361","348"],"joker":false,"kontakt":{"fornamn":"Sten Åke","efternamn":" Bylund","avdelning":"Kulturgeografiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["308","361","348"],"låstaSessioner":[]},{"harVikt":false,"id":"801","grad":2,"frågor":["280","353","354","364","367"],"joker":false,"kontakt":{"fornamn":"Rafael","efternamn":"Lindqvist","avdelning":"Sociologiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["353","364"],"låstaSessioner":[]},{"harVikt":false,"id":"802","grad":1,"frågor":["285","288","354","336","286","304","355","335","323","370"],"joker":false,"kontakt":{"fornamn":"Wendy","efternamn":"Maycraft Kall","avdelning":"Statsvetenskapliga Institutionen","org":"Uppsala"},"låstaFrågor":["285","304","355"],"låstaSessioner":[]},{"harVikt":false,"id":"803","grad":3,"frågor":["355","362","306"],"joker":false,"kontakt":{"fornamn":"Helena ","efternamn":"Wockelberg","avdelning":"Statsvetenskapliga institutionen","org":"Uppsala universitet"},"låstaFrågor":["306","362"],"låstaSessioner":[]},{"harVikt":false,"id":"805","grad":1,"frågor":["366","367"],"joker":true,"kontakt":{"fornamn":"Birgitta ","efternamn":"Södergren","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["367"],"låstaSessioner":[]},{"harVikt":false,"id":"806","grad":4,"frågor":["501","501","285","336","370"],"joker":false,"kontakt":{"fornamn":"Anna","efternamn":"Mankell","avdelning":"Institutionen för folkhälso- och vårdvetenskap","org":"Uppsala universitet"},"låstaFrågor":["501","336","370"],"låstaSessioner":[]},{"harVikt":false,"id":"807","grad":4,"frågor":["335","312","370","304","431","351","289","362","434"],"joker":false,"kontakt":{"fornamn":"Linda","efternamn":"Moberg","avdelning":"Statsvetenskapliga institutionen","org":"Uppsala universitet"},"låstaFrågor":["289","434","362"],"låstaSessioner":[]},{"harVikt":false,"id":"808","grad":4,"frågor":["370","366","305","311"],"joker":false,"kontakt":{"fornamn":"Fredrik ","efternamn":"Olsson","avdelning":"Institutionen för folkhälso- och vårdvetenskap","org":"Uppsala universitet"},"låstaFrågor":["311"],"låstaSessioner":[]},{"harVikt":false,"id":"818","grad":4,"frågor":["286","304","288"],"joker":false,"kontakt":{"fornamn":"Tomas","efternamn":"Högberg","avdelning":"Historiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["286","304","288"],"låstaSessioner":[]},{"harVikt":false,"id":"824","grad":3,"frågor":["441","319","367","368","348"],"joker":false,"kontakt":{"fornamn":"Jan ","efternamn":"Lindvall","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["441","319","348"],"låstaSessioner":[]},{"harVikt":false,"id":"825","grad":3,"frågor":["364","368","289"],"joker":false,"kontakt":{"fornamn":"Maria","efternamn":"Blomgren","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["289","368"],"låstaSessioner":[1,2]},{"harVikt":false,"id":"831","grad":4,"frågor":["286","312","352","353","364","367","435","307"],"joker":false,"kontakt":{"fornamn":"Niklas","efternamn":"Bomark","avdelning":"Företagsekonomiska institutionen","org":"Uppsala Universitet"},"låstaFrågor":["286","307","352"],"låstaSessioner":[]},{"harVikt":false,"id":"836","grad":3,"frågor":["285","364","348","501","354","355","502","327"],"joker":false,"kontakt":{"fornamn":"Nils","efternamn":"Hertting","avdelning":"Statsvet. inst och IBF","org":"Uppsala universitet"},"låstaFrågor":["285","364","348"],"låstaSessioner":[]},{"harVikt":false,"id":"842","grad":2,"frågor":["502","502","366","367","361","363","368","369"],"joker":false,"kontakt":{"fornamn":"Mats","efternamn":"Edenius","avdelning":"Inst för informatik och media","org":"Uppsala universitet"},"låstaFrågor":["361"],"låstaSessioner":[1,2]},{"harVikt":false,"id":"846","grad":1,"frågor":["323","280"],"joker":false,"kontakt":{"fornamn":"Therese","efternamn":"Hartman","avdelning":"Inst för kulturantropologi och etnologi","org":"Uppsala universitet"},"låstaFrågor":["280","323"],"låstaSessioner":[]},{"harVikt":false,"id":"848","grad":1,"frågor":["327","501","501"],"joker":false,"kontakt":{"fornamn":"Susanne","efternamn":"St Clair Renard","avdelning":"Juridiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["501","327"],"låstaSessioner":[]},{"harVikt":false,"id":"849","grad":1,"frågor":["308","317"],"joker":false,"kontakt":{"fornamn":"Mikael","efternamn":"Gidhagen","avdelning":"Företag´sekonomiska inst","org":"Uppsala universitet"},"låstaFrågor":["308"],"låstaSessioner":[1]},{"harVikt":false,"id":"851","grad":1,"frågor":["308","444","431","501","501","502","502","309"],"joker":false,"kontakt":{"fornamn":"Anna","efternamn":"Eriksson-Trenter","avdelning":"Områdeskanslier, Kansliet för humaniora och samhällsvetenskap","org":"Uppsala universitet"},"låstaFrågor":["501","444"],"låstaSessioner":[]},{"harVikt":false,"id":"852","grad":1,"frågor":["286","288","364"],"joker":false,"kontakt":{"fornamn":"Sven ","efternamn":"Jungerhem","avdelning":"Områdeskanslier, Kansliet för humaniora och samhällsvetenskap","org":"Uppsala universitet"},"låstaFrågor":["286","364","288"],"låstaSessioner":[]},{"harVikt":false,"id":"853","grad":4,"frågor":["289","286","288","444","285","336","318","327","317"],"joker":false,"kontakt":{"fornamn":"Ida ","efternamn":"Larsson","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["285","336","288"],"låstaSessioner":[]},{"harVikt":false,"id":"858","grad":2,"frågor":["285","431"],"joker":false,"kontakt":{"fornamn":"Peter","efternamn":"Juslin","avdelning":"Institutionen för psykologi","org":"Uppsala universitet"},"låstaFrågor":["285"],"låstaSessioner":[]},{"harVikt":false,"id":"861","grad":4,"frågor":["364","336","351","361","367","285","369"],"joker":false,"kontakt":{"fornamn":"Sofie ","efternamn":"Vengberg","avdelning":"Institutionen för folkhälso- och vårdvetenskap ","org":"Uppsala universitet"},"låstaFrågor":["367","364","351"],"låstaSessioner":[]},{"harVikt":false,"id":"862","grad":1,"frågor":["502","361","353"],"joker":false,"kontakt":{"fornamn":"Sofia","efternamn":"Murhem","avdelning":"Ekonomisk-historiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["353","361"],"låstaSessioner":[]},{"harVikt":false,"id":"863","grad":4,"frågor":["370","431","335","304","336","363","364","309","311","351"],"joker":false,"kontakt":{"fornamn":"David ","efternamn":"Isaksson","avdelning":"Institutionen för folkhälso- och vårdvetenskap,","org":"Uppsala universitet"},"låstaFrågor":["364"],"låstaSessioner":[]},{"harVikt":false,"id":"865","grad":4,"frågor":["285","312","369"],"joker":false,"kontakt":{"fornamn":"Johanna ","efternamn":"Norberg","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["285","312","369"],"låstaSessioner":[]},{"harVikt":false,"id":"866","grad":4,"frågor":["434","351","288","363"],"joker":false,"kontakt":{"fornamn":"Agata","efternamn":"Kostrzewa","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["434","351"],"låstaSessioner":[]},{"harVikt":false,"id":"872","grad":4,"frågor":["311","280","327","286"],"joker":false,"kontakt":{"fornamn":"Judit","efternamn":"Novak","avdelning":"Institutionen för pedagogik, didaktik och utbildningsstudier","org":"Uppsala universitet"},"låstaFrågor":["280","327","311"],"låstaSessioner":[]},{"harVikt":false,"id":"877","grad":1,"frågor":["280","427","306","355","366","327"],"joker":false,"kontakt":{"fornamn":"Pia","efternamn":"Skott","avdelning":"Inst. pedagogik, didaktik & utbildningsstud.","org":"Uppsala universitet"},"låstaFrågor":["280","327","355"],"låstaSessioner":[]},{"harVikt":false,"id":"878","grad":3,"frågor":["444","367","309","285"],"joker":false,"kontakt":{"fornamn":"Göran","efternamn":"Nilsson","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["367","444"],"låstaSessioner":[]},{"harVikt":false,"id":"879","grad":3,"frågor":["304","312","285"],"joker":false,"kontakt":{"fornamn":"Kari ","efternamn":"Jess","avdelning":"Sociologiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["285","312"],"låstaSessioner":[]},{"harVikt":false,"id":"880","grad":1,"frågor":["348"],"joker":false,"kontakt":{"fornamn":"Anna ","efternamn":"Tyllström","avdelning":"Företagsekonomiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["348"],"låstaSessioner":[2,3]},{"harVikt":false,"id":"884","grad":3,"frågor":["502","367","306","354","355"],"joker":false,"kontakt":{"fornamn":"Marianne ","efternamn":"Danielsson","avdelning":"Institutet för bostads- och urbanforskning (IBF)","org":"Uppsala universitet"},"låstaFrågor":["367","306"],"låstaSessioner":[1,2]},{"harVikt":false,"id":"885","grad":4,"frågor":["285","370","363","336"],"joker":false,"kontakt":{"fornamn":"Sofia","efternamn":"Wagrell","avdelning":"STS-centrum, företagsekonomiska institutionen","org":"Uppsala Universitet"},"låstaFrågor":["285","336","370"],"låstaSessioner":[]},{"harVikt":false,"id":"886","grad":3,"frågor":["280","306","335","362"],"joker":false,"kontakt":{"fornamn":"Lotta","efternamn":"Lerwall","avdelning":"Juridiska institutionen","org":"Uppsala universitet"},"låstaFrågor":["306","362"],"låstaSessioner":[]},{"harVikt":false,"id":"889","grad":1,"frågor":["368","308","348"],"joker":false,"kontakt":{"fornamn":"Sabine ","efternamn":"Gebert Persson","avdelning":"Företagsekonomiska inst","org":"Uppsala universitet"},"låstaFrågor":["308","368","348"],"låstaSessioner":[]},{"harVikt":false,"id":"892","grad":3,"frågor":["289","435","431","501","502","353","368","370","369","362"],"joker":true,"kontakt":{"fornamn":"Henrik","efternamn":"Jordahl","avdelning":"Nationalekonomi","org":"Institutet för näringslivsforskning"},"låstaFrågor":["353","368","369"],"låstaSessioner":[]},{"harVikt":false,"id":"893","grad":3,"frågor":["435","444","308","309","305","318","319","352","311","441"],"joker":true,"kontakt":{"fornamn":"Janis","efternamn":"Angelis","avdelning":"Företagsekonomi","org":"Institutet för näringslivsforskning"},"låstaFrågor":["444","311"],"låstaSessioner":[]},{"harVikt":false,"id":"894","grad":3,"frågor":["356","305","319","335","352","307","441","366","317","362"],"joker":true,"kontakt":{"fornamn":"Karin","efternamn":"Fernler","avdelning":"Department of Management and Organization","org":"Handelshögskolan i Stockholm"},"låstaFrågor":["356","307","362"],"låstaSessioner":[]},{"harVikt":false,"id":"895","grad":4,"frågor":["501","502","309","356","305","348","441","327","323","427"],"joker":true,"kontakt":{"fornamn":"Oscar","efternamn":"Larsson","avdelning":"Statsvetenskapliga institutionen","org":"Uppsala universitet"},"låstaFrågor":["441","427","323"],"låstaSessioner":[]},{"harVikt":false,"id":"896","grad":1,"frågor":["366"],"joker":false,"kontakt":{"fornamn":"Martin","efternamn":"Lundin","avdelning":" Institutet för arbetsmarknads- och utbildningspolitisk utvärdering ","org":"Uppsala universitet"},"låstaFrågor":[],"låstaSessioner":[1,2]}],"schema":{"sessioner":[{"workshops":[{"frageId":"367","forskare":["805","884","774","878","733","861"],"foretagsrepresentanter":["344","346"],"score":1},{"frageId":"285","forskare":["802","885","836","879","865","853","799","858","796","792"],"foretagsrepresentanter":["276"],"score":1},{"frageId":"280","forskare":["788","846","877","872"],"foretagsrepresentanter":["272"],"score":1},{"frageId":"308","forskare":["800","849","889","776"],"foretagsrepresentanter":["298"],"score":1},{"frageId":"441","forskare":["824","765","895"],"foretagsrepresentanter":["290","291"],"score":1},{"frageId":"286","forskare":["680","831","852","818"],"foretagsrepresentanter":["278"],"score":1},{"frageId":"356","forskare":["683","797","894"],"foretagsrepresentanter":["340"],"score":1},{"frageId":"501","forskare":["806","848","851"],"foretagsrepresentanter":["421"],"score":1},{"frageId":"353","forskare":["801","862","892"],"foretagsrepresentanter":["336","338","410"],"score":1},{"frageId":"289","forskare":["807","825","754","798"],"foretagsrepresentanter":["281","282"],"score":1},{"frageId":"366","forskare":["896","808"],"foretagsrepresentanter":["343","345"],"score":1},{"frageId":"363","forskare":["842","866"],"foretagsrepresentanter":["342"],"score":1},{"frageId":"335","forskare":["886","863"],"foretagsrepresentanter":["326","327"],"score":1},{"frageId":"350","forskare":["794","795"],"foretagsrepresentanter":["404","409"],"score":1}]},{"workshops":[{"frageId":"304","forskare":["802","818","796"],"foretagsrepresentanter":["295","396"],"score":1},{"frageId":"306","forskare":["803","788","884","886"],"foretagsrepresentanter":["297"],"score":1},{"frageId":"307","forskare":["831","765","894"],"foretagsrepresentanter":["296"],"score":1},{"frageId":"327","forskare":["848","877","872"],"foretagsrepresentanter":["314","315"],"score":1},{"frageId":"364","forskare":["801","776","836","861","863","754","852"],"foretagsrepresentanter":["343","344","346"],"score":1},{"frageId":"312","forskare":["680","879","865","799"],"foretagsrepresentanter":["310","301"],"score":1},{"frageId":"319","forskare":["683","824","792"],"foretagsrepresentanter":["307"],"score":1},{"frageId":"361","forskare":["842","800","862"],"foretagsrepresentanter":["342"],"score":1},{"frageId":"368","forskare":["889","825","892"],"foretagsrepresentanter":["345"],"score":1},{"frageId":"444","forskare":["878","851","893"],"foretagsrepresentanter":["290","291"],"score":1},{"frageId":"434","forskare":["807","774","866"],"foretagsrepresentanter":["337","338","411"],"score":1},{"frageId":"427","forskare":["798","797","895"],"foretagsrepresentanter":["319"],"score":1},{"frageId":"336","forskare":["806","885","853"],"foretagsrepresentanter":["328"],"score":1}]},{"workshops":[{"frageId":"355","forskare":["802","877","792"],"foretagsrepresentanter":["336"],"score":1},{"frageId":"323","forskare":["788","846","797","895"],"foretagsrepresentanter":["313"],"score":1},{"frageId":"369","forskare":["765","865","799","892"],"foretagsrepresentanter":["345","346"],"score":1},{"frageId":"288","forskare":["852","818","853"],"foretagsrepresentanter":["280"],"score":1},{"frageId":"311","forskare":["680","872","893","808"],"foretagsrepresentanter":["301"],"score":1},{"frageId":"351","forskare":["683","776","861","866"],"foretagsrepresentanter":["337","410","411"],"score":1},{"frageId":"348","forskare":["800","889","880","836","824"],"foretagsrepresentanter":["405"],"score":1},{"frageId":"370","forskare":["806","885","774","754"],"foretagsrepresentanter":["343","344"],"score":1},{"frageId":"362","forskare":["807","803","886","894"],"foretagsrepresentanter":["342"],"score":1},{"frageId":"352","forskare":["831","795","794"],"foretagsrepresentanter":["339","404","409"],"score":1},{"frageId":"502","forskare":["862","851"],"foretagsrepresentanter":["341"],"score":1},{"frageId":"431","forskare":["858","863"],"foretagsrepresentanter":["321","319","318","316","317","310"],"score":1}]}],"sparat":false},"scheduleRequest":{"tracks":17,"sessions":3,"generations":1000,"placeWeight":34,"wsWeight":82,"agendaWeight":34,"maxAntalDeltagare":100,"minAntalDeltagare":2},"låsningar":{"frågesessionslås":[{"id":"280","låsttill":[1]},{"id":"285","låsttill":[1]},{"id":"286","låsttill":[1]},{"id":"288","låsttill":[3]},{"id":"289","låsttill":[1]},{"id":"304","låsttill":[2]},{"id":"306","låsttill":[2]},{"id":"307","låsttill":[2]},{"id":"308","låsttill":[1]},{"id":"311","låsttill":[3]},{"id":"312","låsttill":[2]},{"id":"319","låsttill":[2]},{"id":"323","låsttill":[3]},{"id":"327","låsttill":[2]},{"id":"336","låsttill":[2]},{"id":"348","låsttill":[3]},{"id":"351","låsttill":[3]},{"id":"352","låsttill":[3]},{"id":"353","låsttill":[1]},{"id":"355","låsttill":[3]},{"id":"356","låsttill":[1]},{"id":"361","låsttill":[2]},{"id":"362","låsttill":[3]},{"id":"364","låsttill":[2]},{"id":"367","låsttill":[1]},{"id":"368","låsttill":[2]},{"id":"369","låsttill":[3]},{"id":"370","låsttill":[3]},{"id":"427","låsttill":[2]},{"id":"434","låsttill":[2]},{"id":"441","låsttill":[1]},{"id":"444","låsttill":[2]},{"id":"501","låsttill":[1]}],"frågerumslås":[{"id":"280","låsttill":[3]},{"id":"285","låsttill":[2]},{"id":"286","låsttill":[6]},{"id":"288","låsttill":[4]},{"id":"289","låsttill":[10]},{"id":"304","låsttill":[1]},{"id":"306","låsttill":[2]},{"id":"307","låsttill":[3]},{"id":"308","låsttill":[4]},{"id":"311","låsttill":[5]},{"id":"312","låsttill":[6]},{"id":"319","låsttill":[7]},{"id":"323","låsttill":[2]},{"id":"327","låsttill":[4]},{"id":"336","låsttill":[13]},{"id":"348","låsttill":[7]},{"id":"351","låsttill":[6]},{"id":"352","låsttill":[10]},{"id":"353","låsttill":[9]},{"id":"355","låsttill":[1]},{"id":"356","låsttill":[7]},{"id":"361","låsttill":[8]},{"id":"362","låsttill":[9]},{"id":"364","låsttill":[5]},{"id":"367","låsttill":[1]},{"id":"368","låsttill":[9]},{"id":"369","låsttill":[3]},{"id":"370","låsttill":[8]},{"id":"427","låsttill":[12]},{"id":"434","låsttill":[11]},{"id":"441","låsttill":[5]},{"id":"444","låsttill":[10]},{"id":"501","låsttill":[8]}],"forskarfrågelås":[{"id":"680","låsttill":["286","312","311"]},{"id":"683","låsttill":["356","319","351"]},{"id":"733","låsttill":["367"]},{"id":"754","låsttill":["289","364","370"]},{"id":"765","låsttill":["441","307","369"]},{"id":"774","låsttill":["367","434","370"]},{"id":"776","låsttill":["364","351"]},{"id":"788","låsttill":["280","306","323"]},{"id":"792","låsttill":["285","319","355"]},{"id":"794","låsttill":["352"]},{"id":"795","låsttill":["352"]},{"id":"796","låsttill":["285","304"]},{"id":"797","låsttill":["356","427","323"]},{"id":"798","låsttill":["289","427"]},{"id":"799","låsttill":["285","312","369"]},{"id":"800","låsttill":["308","361","348"]},{"id":"801","låsttill":["353","364"]},{"id":"802","låsttill":["285","304","355"]},{"id":"803","låsttill":["306","362"]},{"id":"805","låsttill":["367"]},{"id":"806","låsttill":["501","336","370"]},{"id":"807","låsttill":["289","434","362"]},{"id":"808","låsttill":["311"]},{"id":"818","låsttill":["286","304","288"]},{"id":"824","låsttill":["441","319","348"]},{"id":"825","låsttill":["289","368"]},{"id":"831","låsttill":["286","307","352"]},{"id":"836","låsttill":["285","364","348"]},{"id":"842","låsttill":["361"]},{"id":"846","låsttill":["280","323"]},{"id":"848","låsttill":["501","327"]},{"id":"849","låsttill":["308"]},{"id":"851","låsttill":["501","444"]},{"id":"852","låsttill":["286","364","288"]},{"id":"853","låsttill":["285","336","288"]},{"id":"858","låsttill":["285"]},{"id":"861","låsttill":["367","364","351"]},{"id":"862","låsttill":["353","361"]},{"id":"863","låsttill":["364"]},{"id":"865","låsttill":["285","312","369"]},{"id":"866","låsttill":["434","351"]},{"id":"872","låsttill":["280","327","311"]},{"id":"877","låsttill":["280","327","355"]},{"id":"878","låsttill":["367","444"]},{"id":"879","låsttill":["285","312"]},{"id":"880","låsttill":["348"]},{"id":"884","låsttill":["367","306"]},{"id":"885","låsttill":["285","336","370"]},{"id":"886","låsttill":["306","362"]},{"id":"889","låsttill":["308","368","348"]},{"id":"892","låsttill":["353","368","369"]},{"id":"893","låsttill":["444","311"]},{"id":"894","låsttill":["356","307","362"]},{"id":"895","låsttill":["441","427","323"]}],"forskarsessionslås":[{"id":"733","låsttill":[1]},{"id":"796","låsttill":[1,2]},{"id":"798","låsttill":[1,2]},{"id":"825","låsttill":[1,2]},{"id":"842","låsttill":[1,2]},{"id":"849","låsttill":[1]},{"id":"880","låsttill":[2,3]},{"id":"884","låsttill":[1,2]},{"id":"896","låsttill":[1,2]}]}};

  // TODO MBP: här måste bytas ut server-side mot den json som ska optimeras schema för:
  var json = ${json.raw()};

  var model = new KonferensModel();
  model.isGenerating = ko.observable(false);
  model.tracks = ko.observableArray();
  model.id = json.id;
  model.namn = json.namn;
  model.optimeringsInformation = json.optimeringsInformation;
  model.senioritetsgrader = json.senioritetsgrader;
  model.scheduleRequest = {
    tracks:ko.observable(json.scheduleRequest? json.scheduleRequest.tracks : 10),
    sessions:ko.observable(json.scheduleRequest? json.scheduleRequest.sessions : 5),
    generations:ko.observable(json.scheduleRequest? json.scheduleRequest.generations :1000),
    placeWeight:ko.observable(json.scheduleRequest? json.scheduleRequest.placeWeight : 50),
    wsWeight:ko.observable(json.scheduleRequest? json.scheduleRequest.wsWeight : 50 ),
    agendaWeight:ko.observable(json.scheduleRequest? json.scheduleRequest.agendaWeight : 50),
    maxAntalDeltagare:ko.observable(json.scheduleRequest? json.scheduleRequest.maxAntalDeltagare : 100),
    minAntalDeltagare:ko.observable(json.scheduleRequest? json.scheduleRequest.minAntalDeltagare : 1)
  }
  model.schema = ko.observable();
  var finnsEttSchemaAttSpara = json.schema != null && json.schema.sessioner != null
  if (finnsEttSchemaAttSpara){
    model.schema(new Schema(json.schema));
    model.sparat(json.schema.sparat);
    model.tracks = ko.observableArray(model.schema().getTracks());
  }
  model.postback_url = json.postback_url;

  for (var i = 0; i < json.foretagsrepresentanter.length; i++) {
      var f = json.foretagsrepresentanter[i];
    model.foretagsrepresentanter.push(new Foretagsrepresentant(f));
  }
  model.hasSchema = ko.computed(function(){
    if (!model.schema()) return false;
    if (!model.schema().sessioner) return false;
    if (!model.schema().sessioner().length >0) return false;

    return true;
  });
  var ändrat = function(){
    if (finnsEttSchemaAttSpara){
      model.sparat(false);
    }
  }
  for (var i = 0; i < json.fragor.length; i++) {
      var f = json.fragor[i];
      var fraga = new Fråga(f);
      fraga.låst.subscribe(ändrat);
    model.fragor.push(fraga);
  }
  for (var i = 0; i < json.forskare.length; i++) {
      var f = new Forskare(json.forskare[i]);
      f.låstaSessioner.subscribe(ändrat);
      f.låstaFrågor.subscribe(ändrat);
    model.forskare.push(f);
  }

  var lastSlide = new Date().getTime();

  ko.bindingHandlers.jqSlider = {
    init: function(element, valueAccessor, allBindingsAccessor, data) {
        //initialize the control
        var options = allBindingsAccessor().jqOptions || {};
        $(element).slider(options);

        //handle the value changing in the UI
        ko.utils.registerEventHandler(element, "slidechange", function() {
          newSlideTime = new Date().getTime();
          if (newSlideTime-lastSlide < 50 ){
            return; // since the sliders are coupled, don't update on the triggered events
          }
          lastSlide = newSlideTime;
            //would need to do some more work here, if you want to bind against non-observables
            var observable = valueAccessor();
            observable($(element).slider("value"));
            data.weightChanged(observable, $(element).slider("value"));

        });

    },
    //handle the model value changing
    update: function(element, valueAccessor) {
        var value = ko.utils.unwrapObservable(valueAccessor());
        $(element).slider("value", value);

    }
  };
  ko.applyBindings(model);


    function Schema(s){
      var self = this;
    self.sessioner = ko.observableArray();
    self.unplacedQuestions = ko.observableArray(s.unplacedQuestions);
    self.unsatisfied = ko.observableArray(s.unsatisfied);
    for (var i = 0; i < s.sessioner.length; i++) {
        var session = s.sessioner[i];
      self.sessioner.push(new Session(session));
    }
    self.getSessionFörFråga = function(frageId){
          var hittadSession = ko.utils.arrayFirst(self.sessioner(), function(s) {
              return (s.harFrageId(frageId));
          });
          return hittadSession;
        }
        self.getTracks = function(){
          var numWs = 0;
          for (var i = 0; i < self.sessioner().length; i++) {
          numWs = Math.max(numWs, self.sessioner()[i].getNumberOfWs());
      }
      // not interested in the actual elements in array, just that it has the correct number of elements:
      return new Array(numWs);
        }
    }

    function Session(s){
      var self = this;
    self.workshops = ko.observableArray();
    for (var i = 0; i < s.workshops.length; i++) {
        var workshop = s.workshops[i];
      self.workshops.push(new Workshop(workshop));
    }

    self.harFrageId = function(frageId){
      var hittadeFråga = false;
      ko.utils.arrayForEach(self.workshops(), function(workshop){
        if (workshop.frageId === frageId){
          hittadeFråga = true;
        }
      });
      return hittadeFråga;
    }

    self.harNågonWorkshopMedForskare = function(forskarId){
          return ko.utils.arrayFirst(self.workshops(), function(workshop) {
              return (workshop.besöksAv(forskarId));
          });
        }
        self.getNumberOfWs = function(){
          return self.workshops().length;
        }
    }

    function Workshop(s){
      var self = this;
      self.frageId = s.frageId;
    self.forskare = ko.observableArray();
    self.forskare.id = s.frageId;
    self.foretagsrepresentanter = s.foretagsrepresentanter;
    for (var i = 0; i < s.forskare.length; i++) {
        var f = s.forskare[i];
      self.forskare.push(f);
    }
    self.besöksAv = function(forskarId){
          return ko.utils.arrayFirst(self.forskare(), function(f) {
              return (f === forskarId);
          });
        }
    }

    function Fråga(f){
      var self = this;
      self.id = ko.observable(f.id);
      self.fråga = ko.observable(f.fråga);
      self.låst = ko.observableArray(f.låst);
      self.låstaRum = ko.observableArray(f.låstaRum);

      self.editing = ko.observable(false);
      self.edit = function() { this.editing(true); }

      self.cappadFråga = ko.computed(function(){
        if (self.fråga().length < 140){
          return self.fråga();
        }
        return self.fråga().slice(0,140) + "...";
      }, this);
      self.ärLåst = ko.computed(function(){return self.låst() != null && self.låst().length > 0;}, this);
      self.ärLåstTillRum = ko.computed(function(){return self.låstaRum() != null && self.låstaRum().length > 0;}, this);
    self.removeLås = function(formElement) {
      self.låst.removeAll();
        }

        self.removeLåstRum = function(formElement){
          self.låstaRum.removeAll();
        }
    }

    function Foretagsrepresentant(f){
      var self = this;
      self.id = ko.observable(f.id);
      self.kontakt = ko.observable(f.kontakt);
      self.namn = ko.computed(function(){return self.kontakt().fornamn + " " + self.kontakt().efternamn;}, this);
      self.frågor = f.frågor;
    }

    function Forskare(f){
      var self = this;
      self.id = ko.observable(f.id);
      if (f.harVikt){
        self.harVikt = ko.observable(f.harVikt);
      } else {
        if (f.harVikt === undefined){
          console.log("Men va faaan!"+f.id);
          }
        self.harVikt = ko.observable(false);
      }
      self.kontakt = ko.observable(f.kontakt);
      self.namn = ko.computed(function(){return self.kontakt().fornamn.charAt(0) +'.' + " " + self.kontakt().efternamn;}, this);
      self.grad = f.grad;
      self.joker = f.joker;
      self.frågor = f.frågor;
      self.låstaSessioner = ko.observableArray(f.låstaSessioner);
        self.frageIdn = ko.observableArray();
    for (var i = 0; i < f.frågor.length; i++) {
        self.frageIdn.push(f.frågor[i]);
    }
      self.låstaFrågor = ko.observableArray(f.låstaFrågor);


      self.editingSession = ko.observable(false);
      self.edit = function() { this.editingSession(true); }
      self.ärLåst = ko.computed(function(){return self.låstaSessioner() != null && self.låstaSessioner().length > 0;}, this);
    self.removeLås = function(formElement) {
      self.låstaSessioner.removeAll();
        }

      self.editingFraga = ko.observable(false);
      self.editFraga = function() { this.editingFraga(true); }
      self.ärLåstTillFråga = ko.computed(function(){return self.låstaFrågor() != null && self.låstaFrågor().length > 0;}, this);
    self.removeFrågeLås = function(formElement) {
      self.låstaFrågor.removeAll();
        }

    }

    function KonferensModel(){
      var self = this;

      self.weightChanged = function(observableChanged, updatedValue){
        var updateOthers = function(updatedValue, observable1, observable2){
          // we want the sum of the three to be 150
          var diff = 150 - updatedValue - observable1() - observable2();
          console.log("diff " +diff);
          if (diff == Math.abs(1)){
            // Special case for one-step changes
            if (Math.random() >0.5){
              observable1(observable1()+diff);
            } else{
              observable2(observable2()+diff);
            }
          } else{
            // For larger changes, distribute based on ratio (more important weight receives most of the change)
            var ratio = (observable1()/ (observable1()+observable2())) ;
            console.log("ratio is " + ratio);

            var oneDiff = Math.round(ratio*diff);
            console.log("obs 1 should be added with " + oneDiff);
            var twoDiff = diff-oneDiff;
            console.log("obs 2 should be added with " + twoDiff);
            observable1(observable1()+oneDiff);
            observable2(observable2()+twoDiff);
          }
        };

        if (observableChanged === self.scheduleRequest.wsWeight){
          console.log("ws slide");
          updateOthers(updatedValue, self.scheduleRequest.placeWeight, self.scheduleRequest.agendaWeight);
        }
        if (observableChanged === self.scheduleRequest.placeWeight){
          console.log("place slide");
          updateOthers(updatedValue, self.scheduleRequest.wsWeight, self.scheduleRequest.agendaWeight);
        }
        if (observableChanged === self.scheduleRequest.agendaWeight){
          console.log("agenda slide");
          updateOthers(updatedValue, self.scheduleRequest.placeWeight, self.scheduleRequest.wsWeight);
        }
      };

      self.setInitialWeights = function(place, ws, agenda){
        self.placeWeight = ko.observable(place || 50);
        self.wsWeight = ko.observable(ws || 50);
        self.agendaWeight = ko.observable(agenda || 50);
      }

    self.sessioner = [1,2,3,4,5,6]; // Antar att vi bara tillåter så här många sessioner
      self.fragor = ko.observableArray();
      self.forskare = ko.observableArray();
      self.foretagsrepresentanter = ko.observableArray();
    self.genereradJson = ko.observable();
    this.lastError = ko.observable();
    self.sparat = ko.observable(true);
    self.nextId = ko.observable();
    self.progress = ko.observable();
    self.isGenerating = false;

    self.låsAllt = function(formElement){

      if (self.schema() === null){
        return false;
      }
      self.sparat(false);
      for(var i = 0; i < self.schema().sessioner().length; i++){
        var session = self.schema().sessioner()[i];
        var rumsNummer = 1;
        ko.utils.arrayForEach(session.workshops(), function(workshop){
          self.låsFrågaTillSessionOchRum(workshop.frageId, i+1, rumsNummer);
          ko.utils.arrayForEach(workshop.forskare(), function(forskare){
            self.låsForskareTillFråga(forskare, workshop.frageId);
          });
          rumsNummer++;
        });
      }
      return false;
    }

    self.låsFrågaTillSessionOchRum = function(frågeId, sessionsId, rumsNummer){
      console.log("Låser fråga " + frågeId + " till session " + sessionsId + " och rum " + rumsNummer);
      var låstaSessioner = self.getFraga(frågeId).låst;
      låstaSessioner.removeAll();
      låstaSessioner.push(sessionsId);
      var låstaRum = self.getFraga(frågeId).låstaRum;
      låstaRum.removeAll();
      låstaRum.push(rumsNummer);
    }
    self.låsForskareTillFråga = function(forskarId, frågeId){
      console.log("Låser forskare " + forskarId + " till fråga " + frågeId);
      var låstaFrågor = self.getForskare(forskarId).låstaFrågor;
      låstaFrågor.remove(frågeId);
      låstaFrågor.push(frågeId);
    }


    self.getLås = function(){
      var frågelås = [];
      var frågerumslås = [];
      for (var i = 0; i < self.fragor().length; i++) {
        var fråga = self.fragor()[i];
        if (fråga.ärLåst()){
          var låstFråga = {id:fråga.id(), låsttill:fråga.låst()};
          frågelås.push(låstFråga);
        }
        if (fråga.ärLåstTillRum()){
          var låstFråga = {id:fråga.id(), låsttill:fråga.låstaRum()};
          frågerumslås.push(låstFråga);
        }
      }

      var forskarFrågeLås = [];
      var forskarTidLås = [];
      for (var i=0; i<self.forskare().length; i++){
        var forskare = self.forskare()[i];
        if(forskare.ärLåstTillFråga()){
          var låstForskare = {id: forskare.id(), låsttill:forskare.låstaFrågor()};
          forskarFrågeLås.push(låstForskare);
        }
        if(forskare.ärLåst()){
          var låstForskare = {id: forskare.id(), låsttill:forskare.låstaSessioner()};
          forskarTidLås.push(låstForskare);
        }
      }

      return {frågesessionslås:frågelås, frågerumslås:frågerumslås, forskarfrågelås:forskarFrågeLås, forskarsessionslås:forskarTidLås};
    }

    self.cancelGeneration = function(){
      console.log("cancelling generation from js. TODO: actually cancel");
    }

    // Called from the isolate/web worker once the new schedule is done
    self.scheduleDone = function(newJson){
      self.isGenerating(false);
      console.log("Received new schedule to js: " + newJson);
      self.newJson = newJson;
      self.progress(100);

      // flödet borde vara:
      // medans schema genereras, ge användaren möjlighet att avbryta schemaläggning
      // spara nytt schema
      // tala om att nytt schema finns
      // ge användaren möjlighet att visa det nya schemat, och jobba vidare med det.
      // ge användaren möjlighet att gå tillbaka till det gamla schemat
    }

    self.changeToNewSchedule = function(){
      var json = JSON.parse(self.newJson);
      self.schema(new Schema(json.schema));
      self.sparat(false);
      $('#generationProgressReport').modal('hide')
      $("html, body").animate({ scrollTop: 0 }, "slow");
    }


    // när generera-knappen trycks så måste vi plocka ut de ändringar som gjorts (låsningar) och
    // skicka med dem till isolaten / web workern
    self.generera = function() {
      self.isGenerating(true);
      self.låsningar = self.getLås();
      var newJson = ko.toJSON(self);

      self.genereradJson(newJson);

      $('#generationProgressReport').modal('show')

      var andback =JSON.parse(newJson);
      andback['genereradJson'] = null;
      andback['bugreport'] = null;

      dartCallback(JSON.stringify(andback), useWebWorker);

    }

    self.saveSchedule = function() {

      self.låsningar = self.getLås();
      var newJson = ko.toJSON(self);
      self.genereradJson(newJson);
      return true;
    }


        self.bugreport = ko.computed({
          read:function(){
        var låsningar = self.getLås();
        json.låsningar = låsningar;
            return JSON.stringify(json);
          }
    });

        self.getForskare = function(id){
          return ko.utils.arrayFirst(self.forskare(), function(f) {
              return (f.id() === id);
          });
          console.log("failed to find forskare with id " + id);
        }

        self.getRep = function(id){
          return ko.utils.arrayFirst(self.foretagsrepresentanter(), function(f) {
              return (f.id() === id);
          });
          console.log("failed to find foretagsrepresentant with id " + id);
        }

        self.getGrad = function(grad){
          return self.senioritetsgrader[grad-1];
        }

        self.getFraga = function(frageId){
          return ko.utils.arrayFirst(self.fragor(), function(f) {
              return (f.id() === frageId);
          });
        }

        this.verifyMoves = function(arg) {
          console.log(arg);
          console.log("Trying to move scientist " + arg.item + " from " + arg.sourceParent.id + " to " + arg.targetParent.id);

          if (arg.sourceParent().length<2){
                self.lastError("Can't move the last researcher in the workshop!");
                arg.cancelDrop = true;
          }
          if (arg.targetParent.indexOf(arg.item) >= 0){
                self.lastError("The researcher is already in the workshop!");
                arg.cancelDrop = true;
          }

          // ingen fråga parallell med till-frågan innehåller forskaren
          var sessionViFlyttarTill = self.schema().getSessionFörFråga(arg.targetParent.id);
          var sessionViFlyttarFrån = self.schema().getSessionFörFråga(arg.sourceParent.id);
          if (sessionViFlyttarTill !== sessionViFlyttarFrån){
            if (sessionViFlyttarTill.harNågonWorkshopMedForskare(arg.item)){
              self.lastError("The researcher is already placed in a workshop that session!");
              arg.cancelDrop = true;
            }
        }

          // flasha om det gick fel inkl anledning:
          if (arg.cancelDrop){
            $('#dragWarningModal').modal('show')
          } else {
          self.sparat(false);
          }
    };
    }

</script>
    <script src="packages/browser/interop.js"></script>
    <script type="application/dart" src="dart_scheduler.dart"></script>
    <script src="packages/browser/dart.js"></script>
    </body>
</html>
